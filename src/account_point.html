<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weeee!</title>
    <link rel="stylesheet" href="./css/style.css" />
    <script
      src="https://kit.fontawesome.com/85f014293c.js"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="./vender/datatables/datatables.min.css">
<!-- 
    <link rel="stylesheet" href="./vender/datatables/dataTables.bootstrap4.css"> -->
  </head>
  <body>
    <header id="header">
  <div class="header_wrapper">
    <div class="header_top container">
      <ul class="header_top_left">
        <li>
          <a href="index.html"><img src="img/otherpage/Weeee.svg" alt="" /></a>
        </li>
        <li>
          <input
            type="text"
            placeholder="輸入目的地、景點、體驗行程或活動名稱...
              "
            maxlength="50"
            @keyup.enter="jump_searched"
            v-model="keyword"
          />
        </li>
        <span>
          <button class="header_search" @click="jump_searched">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
        </span>
      </ul>
      <ul class="header_top_right">
        <li>
          <button class="header_search_m">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
        </li>
        <li>
          <a class="header_shoppingcart" @click="shoppingcart">
            <i class="fa-solid fa-cart-shopping"></i>
            <div class="shoppingcart-num hidden" ref="shoppingcartNum">
              {{headercounter}}
            </div>
          </a>

          <!-- <div class="header_product_group">
            <div class="empty_cart" ref="empty_cart" v-show="emptyCart">
              <img src="img/otherpage/empty-cart.png" alt="" />
              <h6>您的購物車是空的</h6>
              <a href="index.html">跟著Weeee! 一起探索世界</a>
            </div>

            <div class="product_contain">
              <div class="product_item">
                <a href="" class="product-image"
                  ><img src="img/sightseeing/fr_28_1.jpg" alt=""
                /></a>
                <div class="product-name">
                  <a href="">
                    <h6>有得逛有得買，就在桃園</h6>
                  </a>
                </div>
                <div class="delete">
                  <button class="cart_delete" @click="btnClose(index)">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
                <div class="date">
                  <i class="fa-regular fa-calendar-days"></i>2022-12-30
                </div>
                <div class="quantity">
                  <i class="fa-solid fa-person"></i>人數 x 2
                </div>
                <div class="product-price">
                  <h6>TWD 3,475</h6>
                </div>
              </div>

              <div class="product_item">
                <a href="" class="product-image"
                  ><img src="img/sightseeing/fr_28_1.jpg" alt=""
                /></a>
                <div class="product-name">
                  <a href="">
                    <h6>有得逛有得買，就在桃園</h6>
                  </a>
                </div>
                <div class="delete">
                  <button class="cart_delete" @click="btnClose(index)">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
                <div class="date">
                  <i class="fa-regular fa-calendar-days"></i>2022-12-30
                </div>
                <div class="quantity">
                  <i class="fa-solid fa-person"></i>人數 x 2
                </div>
                <div class="product-price">
                  <h6>TWD 3,475</h6>
                </div>
              </div>
              <div class="product_item">
                <a href="" class="product-image"
                  ><img src="img/sightseeing/fr_28_1.jpg" alt=""
                /></a>
                <div class="product-name">
                  <a href="">
                    <h6>有得逛有得買，就在桃園</h6>
                  </a>
                </div>
                <div class="delete">
                  <button class="cart_delete" @click="btnClose(index)">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
                <div class="date">
                  <i class="fa-regular fa-calendar-days"></i>2022-12-30
                </div>
                <div class="quantity">
                  <i class="fa-solid fa-person"></i>人數 x 2
                </div>
                <div class="product-price">
                  <h6>TWD 3,475</h6>
                </div>
              </div>
              <div class="product_item">
                <a href="" class="product-image"
                  ><img src="img/sightseeing/fr_28_1.jpg" alt=""
                /></a>
                <div class="product-name">
                  <a href="">
                    <h6>有得逛有得買，就在桃園</h6>
                  </a>
                </div>
                <div class="delete">
                  <button class="cart_delete" @click="btnClose(index)">
                    <i class="fa-solid fa-trash"></i>
                  </button>
                </div>
                <div class="date">
                  <i class="fa-regular fa-calendar-days"></i>2022-12-30
                </div>
                <div class="quantity">
                  <i class="fa-solid fa-person"></i>人數 x 2
                </div>
                <div class="product-price">
                  <h6>TWD 3,475</h6>
                </div>
              </div>
            </div>

            <div class="gotocart">
              <a href="shoppingcart.html">查看購物車</a>
            </div>
          </div> -->
        </li>
        <li>
          <template v-if="memberID">
            <!-- <i class="fa-solid fa-user"> </i> -->
            <div
              class="member_img"
              :style="{ backgroundImage: 'url(' + headerMemberImg+ ')' }"
            ></div>
            <div class="user_menu">
              <div class="user_setting">
                <a href="account_setting.html">
                  <div class="user_info">
                    <div
                      class="user_icon"
                      :style="{ backgroundImage: 'url(' + headerMemberImg+ ')' }"
                    ></div>
                    <div class="user_name">{{headerFullName}}</div>
                  </div>
                  <i class="fa-solid fa-gear"></i>
                </a>
              </div>
              <ol>
                <li>
                  <a href="account_order.html">
                    <div><i class="fa-regular fa-rectangle-list"></i></div>
                    <h6>訂單管理</h6>
                  </a>
                </li>
                <li>
                  <a href="account_jo.html">
                    <div><i class="fa-solid fa-child-reaching"></i></div>
                    <h6>我的揪團</h6>
                  </a>
                </li>
                <li>
                  <a href="account_favor.html">
                    <div><i class="fa-solid fa-heart"></i></div>
                    <h6>我的收藏</h6>
                  </a>
                </li>
                <li>
                  <a href="account_point.html">
                    <div><img src="img/weeeepoints/yellow.svg" alt="" /></div>
                    <h6>Weeee! Point</h6>
                  </a>
                </li>
              </ol>
              <div class="user_logout">
                <a @click="logout">登出</a>
              </div>
            </div>
          </template>
          <template v-else
            ><i class="fa-solid fa-user" @click="gotologin"> </i
          ></template>
        </li>
      </ul>
    </div>
  </div>

  <div class="header_wrapper">
    <div class="header_bottom container">
      <ul>
        <li>
          <a href="productlist.html?msort=ss" class="header_modal_show"
            ><i class="fa-solid fa-mountain"></i>
            <h6>觀光行程</h6>
          </a>
          <div class="submenu">
            <div class="submenu_title">觀光行程</div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=ss">所有觀光行程</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=ss&ssort=fa">家庭行程</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=ss&ssort=fr">朋友行程</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=ss&ssort=co">情侶行程</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=ss&ssort=pe">寵物行程</a>
            </div>
          </div>
          <ol>
            <li>
              <a href="./productlist.html?msort=ss&ssort=fa">家庭行程</a>
            </li>
            <li>
              <a href="./productlist.html?msort=ss&ssort=fr">朋友行程</a>
            </li>
            <li>
              <a href="./productlist.html?msort=ss&ssort=co">情侶行程</a>
            </li>
            <li>
              <a href="./productlist.html?msort=ss&ssort=pe">寵物行程</a>
            </li>
          </ol>
        </li>
        <li>
          <a href="productlist.html?msort=ep" class="header_modal_show">
            <i class="fa-solid fa-gavel"></i>
            <h6>體驗活動</h6>
          </a>
          <div class="submenu">
            <div class="submenu_title">體驗活動</div>
            <div class="submenu_list">
              <a href="productlist.html?msort=ep">所有體驗活動</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=ep&ssort=hm">手作體驗</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=ep&ssort=ow">水上活動</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=ep&ssort=fa">觀光農場</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=ep&ssort=et">極限運動</a>
            </div>
          </div>
          <ol>
            <li>
              <a href="./productlist.html?msort=ep&ssort=hm">手作體驗</a>
            </li>
            <li>
              <a href="./productlist.html?msort=ep&ssort=ow">水上活動</a>
            </li>
            <li>
              <a href="./productlist.html?msort=ep&ssort=fa">觀光農場</a>
            </li>
            <li>
              <a href="./productlist.html?msort=ep&ssort=et">極限運動</a>
            </li>
          </ol>
        </li>
        <li>
          <a href="productlist.html?msort=tt" class="header_modal_show">
            <i class="fa-solid fa-train-subway"></i>
            <h6>交通票卡</h6>
          </a>
          <div class="submenu">
            <div class="submenu_title">交通票卡</div>
            <div class="submenu_list">
              <a href="productlist.html?msort=tt">所有交通票卡</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=tt&ssort=cl">經典暢遊卡</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=tt&ssort=tr">交通暢遊卡</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=tt&ssort=vp">景點暢遊卡</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=tt&ssort=un">無限暢遊卡</a>
            </div>
          </div>
          <ol>
            <li>
              <a href="./productlist.html?msort=tt&ssort=cl">經典暢遊卡</a>
            </li>
            <li>
              <a href="./productlist.html?msort=tt&ssort=tr">交通暢遊卡</a>
            </li>
            <li>
              <a href="./productlist.html?msort=tt&ssort=vp">景點暢遊卡</a>
            </li>
            <li>
              <a href="./productlist.html?msort=tt&ssort=un">無限暢遊卡</a>
            </li>
          </ol>
        </li>
        <li>
          <a href="productlist.html?msort=vp" class="header_modal_show">
            <i class="fa-solid fa-ticket"></i>
            <h6>景點門票</h6>
          </a>
          <div class="submenu">
            <div class="submenu_title">景點門票</div>
            <div class="submenu_list">
              <a href="productlist.html?msort=vp">所有景點門票</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=vp&ssort=mu">博物館</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=vp&ssort=th">主題樂園</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=vp&ssort=ar">美術館</a>
            </div>
            <div class="submenu_list">
              <a href="./productlist.html?msort=vp&ssort=aq">水族館</a>
            </div>
          </div>
          <ol>
            <li>
              <a href="./productlist.html?msort=vp&ssort=mu">博物館</a>
            </li>
            <li>
              <a href="./productlist.html?msort=vp&ssort=th">主題樂園</a>
            </li>
            <li>
              <a href="./productlist.html?msort=vp&ssort=ar">美術館</a>
            </li>
            <li>
              <a href="./productlist.html?msort=vp&ssort=aq">水族館</a>
            </li>
          </ol>
        </li>
        <li>
          <a href="jo_index.html">
            <i class="fa-solid fa-child-reaching"></i>
            <h6>揪遊趣！</h6>
          </a>
        </li>
      </ul>
    </div>
  </div>

  <div class="header_overlay"></div>

  <div class="search_modal">
    <input
      id="search_m"
      type="text"
      placeholder="輸入目的地、景點、體驗行程或活動名稱...
      "
      maxlength="50"
      @keyup.enter="jump_searched"
      v-model="keyword"
    /><button class="header_search"
    @click="jump_searched">
      <i class="fa-solid fa-magnifying-glass"></i>
    </button>
  </div>
</header>

<!-- <script src="https://code.jquery.com/jquery-3.2.0.min.js"></script>

<script>
  $(".header_modal_show").on("click", function (e) {
    if ($(window).width() < 768) {
      event.preventDefault(e);
      $(this).next(".submenu").addClass("active");
      $(".header_overlay").addClass("active");
    } else {
      $(".submenu").removeClass("active");
    }
  });

  $(".header_search_m").on("click", function () {
    // console.log($(".search_modal"));
    $(".search_modal").css("display", "block");
    $(".header_overlay").addClass("active");
    $("#search_m").focus();
  });

  $(".fa-user").on("click", function () {
    $(".user_menu").css("display", "block");
    $(".header_overlay").addClass("active");
  });

  $(".header_shoppingcart").on("click", function () {
    $(".header_product_group").css("display", "block");
    $(".header_overlay").addClass("active");
  });

  $(".user_menu").css("display", "none");

  // Function for close the Modal
  $(".header_overlay").on("click", function () {
    $(".header_overlay").removeClass("active");
    $(".submenu").removeClass("active");
    $(".search_modal").css("display", "none");
    $(".user_menu").css("display", "none");
    $(".header_product_group").css("display", "none");
  });
</script> -->

    <div class="wrapper account account_point">
      <div class="container">
        <div class="breadcrumbList container">
          <ol class="breadcrumb">
            <li><a href="index.html">首頁</a></li>
            <li style="color: #4484ce">會員中心</li>
            <li>Weeee! Points</li>
          </ol>
        </div>
        <div class="mid">
          <div class="left_bar">
            <div class="img_block">
              <img class="mem_img" id="mem_img" style="cursor: pointer;" onclick="changeImage(this);">
              <form id="memberImgForm" action="php/updateMemImage.php" method="POST" enctype="multipart/form-data">
                <input type="hidden" id="originalUrl" name="originalUrl">  
                <button id = "memberImgBtn" class="blueBtn" type="button" onclick="submitForm();"style="font-size: 15px; padding: 5px 15px; display: none;">確認</button>
              </form>
              <h5 id="fullName"></h5>
            </div>
            <div class="page_list">
              <ul>
                <li>
                  <a href="account_order.html">
                    <div>
                      <i class="fa-regular fa-newspaper"></i>
                    </div>

                    訂單管理
                  </a>
                </li>

                <li>
                  <a href="account_jo.html">
                    <div>
                      <i class="fa-solid fa-user-group"></i>
                    </div>

                    我的揪團
                  </a>
                </li>

                <li>
                  <a href="account_favor.html">
                    <div><i class="fa-solid fa-heart"></i></div>

                    我的收藏
                  </a>
                </li>
                <li>
                  <a href="account_point.html" id="on_page">
                    <div>
                     <img src="./img/weeeepoints/orange.svg" class="">
                    </div>
                    Weeee! Points
                  </a>
                </li>
                <li>
                  <a href="account_setting.html">
                    <div>
                      <i class="fa-solid fa-gear"></i>
                    </div>

                    帳號設定
                  </a>
                </li>
              </ul>
            </div>
          </div>
          <div class="content">
            <h4>Weeee! Points</h4>
            <div class="w_point">
              <h5>目前可使用點數</h5>
              <img src="./img/weeeepoints/yellow.svg" alt="">
              <h5 class="point_count" id="count"></h5>
            </div>

            <div class="points">
              <h5 class="how_use">Weeee! Points 怎麼用?</h5>
              <div class="how_use_rule">
                <i class="fa-regular fa-hand-point-right pointer_right"></i>
                <p class="rule">
                  於Weeee! 進行消費，每100元將回饋1點 Weeee! Point
                  <br/>可於下次預訂時折抵訂單總金額，1點可折抵新台幣1元<br />
                  每筆訂單最多可折抵總金額的20%
                </p>
              </div>
              <hr>
              <h5>點數紀錄</h5>
            <div class="point_record">
                <div class="table-responsive" >
                    <table class="table row-border stripe hover" id="dataTable" width="100%" cellspacing="0" >
                        <thead>
                            <tr class="table-head">
                                <th>訂單編號</th>
                                <th>日期</th>
                                <th>總金額</th>  
                                <th>點數</th>                      
                            </tr>
                        </thead>
                        
                        <tbody id="tbody">
                        </tbody>
                    </table>
                </div>
            </div>
          </div>
        </div>
            </div>
        
      </div>
      
    <footer class="ftoc">
      <div class="footer_wrapper wrapper">
        <div class="footer_container container">
          <div class="footer_left">
            <p>
              旅遊產品由 Weeee!國際旅行社股份有限公司 提供<br />
              統一編號：24977419<br />
              旅行業註冊編號：交觀綜第 220209 號<br />
              品保協會會員編號：北2169號<br />
              聯絡地址：台灣台北市內湖區新湖一路128巷1號3樓<br />
              聯絡電話：02-7741-7453<br />
              傳真：02-8791-4609<br />
              E-mail：service@weeee.com
            </p>
          </div>
          <div class="footer_center">
            <ul>
              <li><a href="about.html">關於Weeee!</a></li>
              <li><a href="terms_of_use.html">使用者條款</a></li>
              <li><a href="privacy_policy.html">隱私權政策</a></li>
              <li><a href="qa_buy.html">常見問題</a></li>
            </ul>
          </div>
          <div class="footer_right">
            <div class="footer_right_tips">
              <span
                >即刻訂閱Weeee! EDM
                搶先獲得用戶限定優惠及最新熱門景點旅遊資訊！</span
              >
              <p>
                點擊「訂閱」即表示同意<a href="terms_of_use.html"
                  >使用者條款</a
                >與<a href="privacy_policy.html">隱私權政策</a>
              </p>
            </div>
            <div class="footer_right_input">
              <input
                type="text"
                placeholder="輸入電子信箱
                    "
              /><button type="button">訂閱</button>
            </div>
            <div class="footer_right_payment">
              <span>付款方式</span>
              <ul>
                <li><img src="img/creditcard/visa.svg" alt="" /></li>
                <li><img src="img/creditcard/mastercard.svg" alt="" /></li>
                <li><img src="img/creditcard/jcb.svg" alt="" /></li>
                <li><img src="img/creditcard/ae.svg" alt="" /></li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="footer_tibame">
        <p>
          本網站為緯育TibaMe前端工程師班第80期學員專題作品，本平台僅供學習、展示之用。參考資源：KKday
          、Klook
        </p>
      </div>
    </footer>


    </div>
  
    <script src="vender/jquery/jquery.min.js"></script>
    <script src="./vender/vue/vue.global.prod.js"></script>
    <script src="js/header.js"></script>
    <script src="./vender/datatables/jquery.dataTables.min.js"></script>
    <script src="./vender/datatables/dataTables.bootstrap4.min.js"></script>
    <!-- 加入sweet alert -->
    <script src="./vender/sweetAlert/sweetalert2.all.min.js"></script>
    <script>
    // Call the dataTables jQuery plugin
    $(document).ready(function() {
       
    });

    //一進到頁面，就發請求去資料庫取點數資料
    $.ajax({
        method: "GET",
        url: "php/query_account_point.php",
        data: {},
        dataType: "json",
        success: function (response) {
          //印到HTML上
          let tbody = document.getElementById("tbody");
          let sum = 0;
          for (let i = 0; i < response.length; i++) {
            let point_content = `
              <tr>
                <td>${response[i].OrderNumber}</td>
                <td>${response[i].OrderDate}</td>
                <td>${response[i].TotalPrice}</td> 
                <td>${response[i].PointsChange}</td>            
              </tr>
      `;
            tbody.insertAdjacentHTML("beforeend", point_content);
            sum = sum + response[i].PointsChange;
            
            //顯示會員全名在左側
            $("#fullName").html(response[i].LastName + response[i].FirstName);
          }
          document.getElementById("count").innerHTML = sum;
          $('#dataTable').DataTable({
            paging: false, // 拿掉一頁顯示幾個篩選結果
            "searching": false, // 拿掉搜尋bar
            "info": false, // 拿掉左下角共幾個結果的資訊
            "ordering": false
        });
        
        },
      });


      $(document).ready(function() {
              $.ajax({
                  method: "GET",
                  url: "php/query_account_setting.php",
                  data: {},
                  dataType: "json",
                  success: function (response) {
                    $("#mem_img").attr("src", response.MemberImg);
                    $("#fullName").attr("src", response.LastName + response.FirstName);
                    let url = window.location.href;
                    $("#originalUrl").val(url.substring(url.lastIndexOf("/") + 1));
                  }
                });
            }); 

            function changeImage(e) {
              let id = "imageFile";
              if (!document.getElementById(id)) {
                  $("#memberImgForm").append(
                  `
                      <input type="file" id="${id}" name="${id}" style="display:none;">
                  `
                  )
              }
              document.getElementById(id).addEventListener("change", function() {
                  // 讀取file
                  let fileList = this.files;
                  let file = fileList[0];
                  let fileReader = new FileReader();
                  fileReader.readAsDataURL(file);
                  fileReader.addEventListener("load", function(){
                      $("#mem_img").attr("src", fileReader.result);
                      $("#memberImgBtn").show();
                  });
              });
              $("#" + id).click();
        }

        function submitForm() {
          Swal.fire({
                position: "center",
                icon: "success",
                title: "修改成功",
                showConfirmButton: false,
                timer: 1000,
            }).then(function(){
                $("#memberImgForm").submit();
            });
        }
    </script>
  </body>
</html>
